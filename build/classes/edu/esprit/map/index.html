<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
       <title>Recherche d'adresse avec Mapbox</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src='https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.js'></script>
        
<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.0/mapbox-gl-geocoder.min.js'></script>

<link href='https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.css' rel='stylesheet' />
<link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.0/mapbox-gl-geocoder.css' type='text/css' />


<style>
        body { margin: 0; padding: 0; }
        #map { width: 60%; height: 100vh; position: fixed; right: 0 }
        #search-input { width: 100%; font-size: 16px; padding: 10px; border-radius: 5px; border: 1px solid #ccc; }
    </style>
    </head>
    <body>
      <div id='map'></div>
      
      <p id="result"></p>

<script>
  mapboxgl.accessToken = 'pk.eyJ1IjoibW9sa2FrIiwiYSI6ImNsZ2plbjJxNjE0eWEzam15d25laXpnOW8ifQ.FiBDHoywl1qlCHngIwZGOQ';
  var map = new mapboxgl.Map({
    container: 'map',
     center: [9.537499, 33.886917],
  zoom: 5,
    style: 'mapbox://styles/mapbox/streets-v11'
    
   });
    // Add geolocate control to the map.
    map.addControl(new mapboxgl.GeolocateControl({
        positionOptions: {
            enableHighAccuracy: true
        },
        trackUserLocation: true
    }));
    
    
    
    fetch('https://api.mapbox.com/geocoding/v5/mapbox.places/La Marsa.json?access_token='+ mapboxgl.accessToken)
  .then(response => response.json())
  .then(data => {
    // Extraire les informations pertinentes de la réponse JSON
    const features = data.features;
    const address = features[0].place_name;
    const longitude = features[0].center[0];
    const latitude = features[0].center[1];
    
    // Récupérer l'élément HTML avec l'ID "result"
const resultElement = document.getElementById("result");

// Mettre à jour le contenu de l'élément avec les résultats
resultElement.innerHTML = `Adresse: ${address} <br> Longitude: ${longitude} <br> Latitude: ${latitude}`;

  });
  
  
var geocoder = new MapboxGeocoder({
            accessToken: mapboxgl.accessToken,
            placeholder: 'Rechercher une adresse',
            mapboxgl: mapboxgl
        });
        
        map.addControl(geocoder);

        map.on('load', function() {
            map.addSource('geocode', {
                type: 'geojson',
                data: {
                    type: 'FeatureCollection',
                    features: []
                }
            });

            map.addLayer({
                id: 'geocode-point',
                type: 'circle',
                source: 'geocode',
                paint: {
                    'circle-radius': 10,
                    'circle-color': '#007cbf'
                },
                filter: ['==', '$type', 'Point']
            });

            map.addLayer({
                id: 'geocode-label',
                type: 'symbol',
                source: 'geocode',
                layout: {
                    'text-field': ['get', 'place_name'],
                    'text-size': 16,
                    'text-offset': [0, 0.6],
                    'text-anchor': 'top'
                },
                filter: ['==', '$type', 'Point']
            });

        geocoder.on('result', function(ev) {
  var searchResult = ev.result.geometry;
  map.getSource('geocode').setData({
    type: 'FeatureCollection',
    features: [{
      type: 'Feature',
      properties: {},
      geometry: {
        type: 'Point',
        coordinates: searchResult.coordinates
      }
    }]
  });

  // Récupérer l'adresse, la longitude et la latitude de la recherche
  var address = ev.result.place_name;
  var longitude = searchResult.coordinates[0];
  var latitude = searchResult.coordinates[1];

  // Afficher les résultats dans la page
  var resultElement = document.getElementById('result');
  resultElement.innerHTML = `Adresse: ${address}<br>Longitude: ${longitude}<br>Latitude: ${latitude}`;
});

});


function geocode(address, callback) {
  var request = 'https://api.mapbox.com/geocoding/v5/mapbox.places/' + encodeURIComponent(address) + '.json?access_token=' + mapboxgl.accessToken;
  fetch(request)
    .then(function(response) {
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      return response.json();
    })
    .then(function(data) {
      var feature = data.features[0];
      var coordinates = feature.geometry.coordinates;
      callback(coordinates);
    })
    .catch(function(error) {
      console.log('There was a problem with the geocoding request:', error);
    });
}

function addMarker(coordinates) {
  var marker = new mapboxgl.Marker()
    .setLngLat(coordinates)
    .addTo(map);
}






</script>
</body>
</html>
